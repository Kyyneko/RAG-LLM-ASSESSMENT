services:
  rag-llm:
    build: .
    container_name: rag-llm-assessment
    network_mode: host
    env_file:
      - .env
    environment:
      - DB_HOST=${DB_HOST:-host.docker.internal}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=${DB_NAME}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
    volumes:
      - ./data:/app/data
      - ./Modul-Modul-Lab-SI:/app/Modul-Modul-Lab-SI
      - ~/.cache/huggingface:/root/.cache/huggingface
      # Mount SILAB-BE modules folder so container can access module files
      - /var/www/SILAB-BE/app/uploads/modules:/var/www/SILAB-BE/app/uploads/modules:ro
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:5002/" ]
      interval: 30s
      timeout: 10s
      retries: 3
